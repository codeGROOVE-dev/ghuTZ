<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>guTZ GitHub Timezone Detective</title>
        <style>
            :root {
                --burnt-orange: #cc5500;
                --deep-brown: #8b4513;
                --golden-yellow: #ffa500;
                --rust-red: #cd853f;
                --forest-green: #228b22;
                --bright-orange: #ff4500;
                --golden: #ffd700;
                --cream: #f5deb3;
                --dark-brown: #654321;
                --off-black: #2f1b14;

                /* Nigerian textile pattern colors */
                --kente-red: #b8860b;
                --earth-orange: #d2691e;
                --mud-brown: #a0522d;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "SF Pro Text",
                    "Helvetica Neue", Arial, sans-serif;
                background: linear-gradient(
                    45deg,
                    var(--burnt-orange) 0%,
                    var(--rust-red) 30%,
                    var(--golden-yellow) 70%,
                    var(--earth-orange) 100%
                );
                color: var(--off-black);
                min-height: 100vh;
                margin: 0;
                padding: 8px;
                position: relative;
            }

            /* Nigerian-inspired geometric pattern overlay */
            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image:
                    repeating-linear-gradient(
                        30deg,
                        transparent,
                        transparent 8px,
                        rgba(139, 69, 19, 0.08) 8px,
                        rgba(139, 69, 19, 0.08) 16px
                    ),
                    repeating-linear-gradient(
                        -30deg,
                        transparent,
                        transparent 12px,
                        rgba(205, 133, 63, 0.06) 12px,
                        rgba(205, 133, 63, 0.06) 24px
                    ),
                    radial-gradient(
                        circle at 25% 25%,
                        rgba(255, 165, 0, 0.05) 0%,
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at 75% 75%,
                        rgba(204, 85, 0, 0.05) 0%,
                        transparent 50%
                    );
                z-index: -1;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: var(--cream);
                border: 3px solid var(--dark-brown);
                box-shadow: 8px 8px 0px var(--off-black);
            }

            .header {
                background: var(--deep-brown);
                color: var(--golden);
                padding: 8px 16px;
                border-bottom: 2px solid var(--off-black);
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .logo {
                font-weight: 700;
                font-size: 18px;
                letter-spacing: 1px;
            }

            .tagline {
                font-size: 11px;
                opacity: 0.9;
                font-weight: 500;
            }

            .main-content {
                padding: 12px 16px;
                display: grid;
                grid-template-columns: 300px 1fr;
                gap: 16px;
                min-height: 400px;
            }

            .left-panel {
                background: var(--golden-yellow);
                border: 2px solid var(--off-black);
                padding: 12px;
            }

            .input-section h3 {
                font-size: 13px;
                font-weight: 700;
                color: var(--off-black);
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .input-row {
                display: flex;
                gap: 6px;
                margin-bottom: 8px;
            }

            .input-row input {
                flex: 1;
                padding: 6px 8px;
                border: 2px solid var(--off-black);
                background: var(--cream);
                color: var(--off-black);
                font-size: 14px;
                font-weight: 500;
            }

            .input-row input:focus {
                outline: none;
                box-shadow: 0 0 0 2px var(--bright-orange);
            }

            .detect-btn {
                background: var(--off-black);
                color: var(--golden);
                border: none;
                padding: 6px 16px;
                font-weight: 700;
                font-size: 14px;
                cursor: pointer;
                text-transform: uppercase;
                letter-spacing: 1px;
                transition: all 0.1s ease;
            }

            .detect-btn:hover:not(:disabled) {
                background: var(--bright-orange);
                color: var(--off-black);
            }

            .detect-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            .stats-compact {
                margin-top: 12px;
                font-size: 11px;
                line-height: 1.3;
            }

            .stats-compact .stat {
                display: flex;
                justify-content: space-between;
                margin-bottom: 3px;
                font-weight: 600;
            }

            .right-panel {
                background: var(--cream);
                border: 2px solid var(--rust-red);
                padding: 12px;
                overflow-y: auto;
                max-height: 400px;
            }

            .result-container {
                display: none;
            }

            .result-container.show {
                display: block;
            }

            .result-header {
                background: var(--rust-red);
                color: var(--cream);
                padding: 6px 8px;
                margin: -12px -12px 8px -12px;
                font-weight: 700;
                font-size: 13px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .result-grid {
                display: grid;
                grid-template-columns: 60px 1fr;
                gap: 6px 12px;
                font-size: 12px;
                line-height: 1.4;
            }

            .result-label {
                font-weight: 700;
                color: var(--deep-brown);
                text-transform: uppercase;
                font-size: 10px;
            }

            .result-value {
                font-weight: 600;
                color: var(--off-black);
                background: var(--golden-yellow);
                padding: 2px 6px;
                border: 1px solid var(--off-black);
                font-family: "SF Mono", Monaco, "Cascadia Code", monospace;
                font-size: 11px;
            }

            .confidence-badge {
                font-size: 10px;
                padding: 1px 4px;
                border: 1px solid var(--off-black);
                font-weight: 700;
                text-transform: uppercase;
            }

            .confidence-high {
                background: var(--forest-green);
                color: var(--cream);
            }
            .confidence-medium {
                background: var(--golden-yellow);
                color: var(--off-black);
            }
            .confidence-low {
                background: var(--bright-orange);
                color: var(--cream);
            }

            .map-container {
                margin-top: 8px;
                border: 2px solid var(--off-black);
                height: 100px;
                background: var(--cream);
                overflow: hidden;
            }

            .error-msg {
                background: var(--bright-orange);
                color: var(--cream);
                border: 2px solid var(--off-black);
                padding: 6px 8px;
                margin-top: 8px;
                display: none;
                font-size: 11px;
                font-weight: 700;
            }

            .error-msg.show {
                display: block;
            }

            .info-section {
                margin-top: 12px;
                background: var(--golden-yellow);
                border: 1px solid var(--deep-brown);
                padding: 8px;
            }

            .info-title {
                font-size: 11px;
                font-weight: 700;
                color: var(--off-black);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 6px;
                border-bottom: 1px solid var(--deep-brown);
                padding-bottom: 2px;
            }

            .info-content {
                font-size: 10px;
                line-height: 1.3;
                color: var(--dark-brown);
            }

            .footer {
                background: var(--off-black);
                color: var(--golden);
                padding: 6px 16px;
                text-align: center;
                font-size: 10px;
                border-top: 2px solid var(--dark-brown);
            }

            .footer a {
                color: var(--golden);
                text-decoration: none;
                font-weight: 700;
            }

            .footer a:hover {
                color: var(--bright-orange);
            }

            /* Mobile responsiveness */
            @media (max-width: 768px) {
                body {
                    padding: 4px;
                }
                .main-content {
                    grid-template-columns: 1fr;
                    gap: 12px;
                    padding: 8px 12px;
                }
                .container {
                    box-shadow: 4px 4px 0px var(--off-black);
                }
                .input-row {
                    flex-wrap: wrap;
                }
                .detect-btn {
                    width: 100%;
                    margin-top: 4px;
                }
            }

            /* Compact height optimization */
            @media (max-height: 600px) {
                .main-content {
                    min-height: auto;
                    padding: 8px 12px;
                }
                .right-panel {
                    max-height: 300px;
                }
                .map-container {
                    height: 80px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <div class="logo">guTZ v2.1</div>
                <div class="tagline">github timezone detection</div>
            </div>

            <div class="main-content">
                <div class="left-panel">
                    <div class="input-section">
                        <h3>▸ Detect User</h3>
                        <form id="detectForm">
                            <div class="input-row">
                                <input
                                    type="text"
                                    id="username"
                                    placeholder="github-username"
                                    required
                                />
                                <button
                                    type="submit"
                                    class="detect-btn"
                                    id="submitBtn"
                                >
                                    GO
                                </button>
                            </div>
                        </form>
                        <div id="error" class="error-msg"></div>
                    </div>

                    <div class="stats-compact">
                        <div class="stat">
                            <span>Cache:</span>
                            <span>100k entries</span>
                        </div>
                        <div class="stat">
                            <span>Methods:</span>
                            <span>8 detection types</span>
                        </div>
                        <div class="stat">
                            <span>Speed:</span>
                            <span>&lt; 2 seconds</span>
                        </div>
                        <div class="stat">
                            <span>Accuracy:</span>
                            <span>~85% average</span>
                        </div>
                    </div>

                    <div class="info-section">
                        <div class="info-title">▸ Detection Methods</div>
                        <div class="info-content">
                            • Profile timezone extraction<br />
                            • Location geocoding<br />
                            • Activity pattern analysis (AI)<br />
                            • Company location heuristics<br />
                            • Email domain analysis<br />
                            • Website content analysis<br />
                            • Work schedule inference<br />
                            • Lunch break detection
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div id="result" class="result-container">
                        <div class="result-header">Detection Results</div>
                        <div class="result-grid">
                            <div class="result-label">User:</div>
                            <div class="result-value" id="displayUsername">
                                -
                            </div>

                            <div class="result-label">Zone:</div>
                            <div class="result-value" id="timezone">-</div>

                            <div class="result-label">Conf:</div>
                            <div class="result-value">
                                <span id="confidence" class="confidence-badge"
                                    >-</span
                                >
                            </div>

                            <div
                                class="result-label"
                                id="activityLabel"
                                style="display: none"
                            >
                                Activity:
                            </div>
                            <div
                                class="result-value"
                                id="activityTz"
                                style="display: none"
                            >
                                -
                            </div>

                            <div
                                class="result-label"
                                id="hoursLabel"
                                style="display: none"
                            >
                                Hours:
                            </div>
                            <div
                                class="result-value"
                                id="activeHours"
                                style="display: none"
                            >
                                -
                            </div>

                            <div
                                class="result-label"
                                id="lunchLabel"
                                style="display: none"
                            >
                                Lunch:
                            </div>
                            <div
                                class="result-value"
                                id="lunchHours"
                                style="display: none"
                            >
                                -
                            </div>

                            <div
                                class="result-label"
                                id="locationLabel"
                                style="display: none"
                            >
                                Location:
                            </div>
                            <div
                                class="result-value"
                                id="location"
                                style="display: none"
                            >
                                -
                            </div>

                            <div class="result-label">Method:</div>
                            <div class="result-value" id="method">-</div>
                        </div>

                        <div
                            id="map"
                            class="map-container"
                            style="display: none"
                        ></div>
                    </div>

                    <div class="info-section">
                        <div class="info-title">▸ How It Works</div>
                        <div class="info-content">
                            Analyzes GitHub activity patterns, profile data, and
                            contextual clues to determine timezone. Uses AI to
                            cross-reference work schedules, lunch breaks, and
                            sleep patterns for accuracy. Supports remote work
                            detection and handles multiple timezone evidence
                            sources.
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer">
                <a href="https://codegroove.dev">codeGROOVE</a> • faster code
                reviews • powered by AI pattern analysis
            </div>
        </div>

        <script>
            let currentUsername = "";

            window.addEventListener("load", function () {
                const urlParams = new URLSearchParams(window.location.search);
                const usernameParam = urlParams.get("u");

                if (usernameParam) {
                    document.getElementById("username").value = usernameParam;
                    // Update page title with username from URL
                    document.title = usernameParam + " - guTZ GitHub Timezone Detective";
                    setTimeout(() => {
                        document
                            .getElementById("detectForm")
                            .dispatchEvent(new Event("submit"));
                    }, 500);
                }
            });

            function updateURL(username) {
                currentUsername = username;
                const newURL = new URL(window.location);
                newURL.searchParams.set("u", username);
                window.history.replaceState({}, "", newURL);
                // Update page title with username
                document.title = username + " - guTZ GitHub Timezone Detective";
            }

            document
                .getElementById("detectForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const username = document
                        .getElementById("username")
                        .value.trim();
                    const submitBtn = document.getElementById("submitBtn");
                    const errorDiv = document.getElementById("error");
                    const resultDiv = document.getElementById("result");

                    if (!username) return;

                    submitBtn.disabled = true;
                    submitBtn.innerHTML = "...";
                    errorDiv.classList.remove("show");
                    resultDiv.classList.remove("show");

                    try {
                        const response = await fetch("/api/v1/detect", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ username }),
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(errorText || "Detection failed");
                        }

                        const data = await response.json();
                        updateURL(username);
                        displayResults(data);
                    } catch (error) {
                        errorDiv.textContent = "ERROR: " + error.message;
                        errorDiv.classList.add("show");
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = "GO";
                    }
                });

            function displayResults(data) {
                document.getElementById("displayUsername").textContent =
                    data.username;
                document.getElementById("timezone").textContent = data.timezone;

                const confidenceSpan = document.getElementById("confidence");
                const confidencePct = Math.round(
                    (data.timezone_confidence || data.confidence || 0) * 100,
                );
                const badges = ["●●●", "●●○", "●○○", "○○○"];
                let badgeIndex, badgeClass;

                if (confidencePct >= 90) {
                    badgeIndex = 0;
                    badgeClass = "confidence-high";
                } else if (confidencePct >= 70) {
                    badgeIndex = 1;
                    badgeClass = "confidence-high";
                } else if (confidencePct >= 50) {
                    badgeIndex = 2;
                    badgeClass = "confidence-medium";
                } else {
                    badgeIndex = 3;
                    badgeClass = "confidence-low";
                }

                confidenceSpan.textContent =
                    badges[badgeIndex] + " " + confidencePct + "%";
                confidenceSpan.className = "confidence-badge " + badgeClass;

                if (data.activity_timezone) {
                    document.getElementById("activityTz").textContent =
                        data.activity_timezone;
                    document.getElementById("activityLabel").style.display =
                        "block";
                    document.getElementById("activityTz").style.display =
                        "block";
                }

                if (
                    data.active_hours_local &&
                    (data.active_hours_local.start ||
                        data.active_hours_local.end)
                ) {
                    const activeHoursText = formatActiveHours(
                        data.active_hours_local.start,
                        data.active_hours_local.end,
                    );
                    document.getElementById("activeHours").textContent =
                        activeHoursText;
                    document.getElementById("hoursLabel").style.display =
                        "block";
                    document.getElementById("activeHours").style.display =
                        "block";
                }

                if (
                    data.lunch_hours_local &&
                    data.lunch_hours_local.confidence > 0
                ) {
                    const lunchText = formatLunchHours(
                        data.lunch_hours_local.start,
                        data.lunch_hours_local.end,
                    );
                    document.getElementById("lunchHours").textContent =
                        lunchText;
                    document.getElementById("lunchLabel").style.display =
                        "block";
                    document.getElementById("lunchHours").style.display =
                        "block";
                }

                let locationText = "";
                if (data.gemini_suggested_location) {
                    locationText = data.gemini_suggested_location;
                } else if (data.location_name) {
                    locationText = data.location_name;
                } else if (data.location) {
                    locationText =
                        data.location.latitude.toFixed(1) +
                        ", " +
                        data.location.longitude.toFixed(1);
                }

                if (locationText) {
                    document.getElementById("location").textContent =
                        locationText;
                    document.getElementById("locationLabel").style.display =
                        "block";
                    document.getElementById("location").style.display = "block";
                }

                const methodName = formatMethodName(data.method);
                document.getElementById("method").textContent = methodName;

                if (data.location) {
                    initMap(
                        data.location.latitude,
                        data.location.longitude,
                        data.username,
                    );
                }

                document.getElementById("result").classList.add("show");
            }

            function formatMethodName(method) {
                const methodNames = {
                    github_profile: "profile",
                    location_geocoding: "geocoding",
                    activity_patterns: "activity",
                    gemini_refined_activity: "ai+activity",
                    company_heuristic: "company",
                    email_heuristic: "email",
                    blog_heuristic: "blog",
                    website_gemini_analysis: "website+ai",
                    gemini_analysis: "ai",
                };
                return methodNames[method] || method;
            }

            function formatActiveHours(start, end) {
                return formatHour(start) + "-" + formatHour(end);
            }

            function formatLunchHours(start, end) {
                return formatHour(start) + "-" + formatHour(end);
            }

            function formatHour(decimalHour) {
                const hour = Math.floor(decimalHour);
                const minutes = Math.round((decimalHour - hour) * 60);
                const period = hour < 12 ? "am" : "pm";
                const displayHour =
                    hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                const minuteStr =
                    minutes === 0 ? "00" : minutes.toString().padStart(2, "0");
                return displayHour + ":" + minuteStr + period;
            }

            function initMap(lat, lng, username) {
                const mapDiv = document.getElementById("map");
                mapDiv.style.display = "block";
                mapDiv.innerHTML =
                    '<iframe width="100%" height="100%" frameborder="0" style="border:0" ' +
                    'src="https://www.openstreetmap.org/export/embed.html?bbox=' +
                    (lng - 0.1) +
                    "," +
                    (lat - 0.1) +
                    "," +
                    (lng + 0.1) +
                    "," +
                    (lat + 0.1) +
                    "&layer=mapnik&marker=" +
                    lat +
                    "," +
                    lng +
                    '" allowfullscreen></iframe>';
            }

            document.addEventListener("keydown", (e) => {
                if (e.key === "Enter" && e.ctrlKey) {
                    document
                        .getElementById("detectForm")
                        .dispatchEvent(new Event("submit"));
                }
            });
        </script>
    </body>
</html>
